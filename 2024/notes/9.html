<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>CS50x en Fran√ßais</title>

    <!-- http://getbootstrap.com/docs/4.5/getting-started/introduction/ -->
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/popper.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>

    <!-- https://momentjs.com/, https://momentjs.com/timezone/ -->
    <script src="/static/js/moment.min.js"></script>
    <script src="/static/js/moment-timezone-with-data.min.js"></script>
    <script src="/static/js/luxon.min.js"></script>

    <!-- https://www.algolia.com/doc/guides/building-search-ui/installation/js/ -->
    <script src="/static/js/algoliasearchLite.min.js"></script>
    <script src="/static/js/instantsearch.production.min.js"></script>
    <script src="/static/js/jekyll-theme-cs50.js"></script>

    <script id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="/static/highlight/highlight.min.js"></script>
    <script>
      hljs.initHighlightingOnLoad();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.8.0/dist/mermaid.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/static/highlight/styles/vs.min.css"/>
    <link rel="stylesheet" href="/static/css/page.css">

    <style>
      code {
        color: black;
        border: 1px solid #dee2e6;
      }

      pre > code {
        padding: 0 !important;
      }

      pre {
        border: 1px solid #dee2e6;
      }

      .mermaid {
        background-color: white !important;
        border: none !important;
      }
    </style>
  </head>

  <body>
    <!-- Markdown Flux Diagrams -->
    <script type="module">
      mermaid.initialize({startOnLoad: true});
    </script>
    <div class="container-fluid">
      <div class="row">
        <aside class="col-md" style="background-color: darkblue">
  <header>
    <h1>
      <a href="">CS50x en Fran√ßais</a>
    </h1>

    <p>
      <a target="_blank" href=""></a>
      <br/>
      2024
    </p>
  </header>

  <button class="btn btn-sm collapsed d-md-none" aria-controls="nav" aria-expanded="false" data-target="aside &gt; nav" data-toggle="collapse">
    Menu
  </button>

  <nav class="collapse d-md-block" id="nav">
    <hr/>

    <ul>
      <li>
        <a href="/2024/semaines/0.html">Semaine
          0</a>
        Scratch üò∫
      </li>
      <li>
        <a href="/2024/semaines/1.html">Semaine
          1</a>
        C
      </li>
      <li>
        <a href="/2024/semaines/2.html">Semaine
          2</a>
        Tableaux
      </li>
      <li>
        <a href="/2024/semaines/3.html">Semaine
          3</a>
        Algorithmes
      </li>
      <li>
        <a href="/2024/semaines/4.html">Semaine
          4</a>
        M√©moire
      </li>
      <li>
        <a href="/2024/semaines/5.html">Semaine
          5</a>
        Structures de Donn√©es
      </li>
      <li>
        <a href="/2024/semaines/6.html">Semaine
          6</a>
        Python
      </li>
      <li>
        <a href="/2024/semaines/7.html">Semaine
          7</a>
        SQL
      </li>
      <li>
        <a href="/2024/semaines/8.html">Semaine
          8</a>
        HTML, CSS, JavaScript
      </li>
      <li>
        <a href="/2024/semaines/9.html">Semaine
          9</a>
        Flask
      </li>
      <li>
        <a href="/2024/semaines/10.html">Semaine
          10</a>
        Cybers√©curit√©
      </li>
    </ul>

    <hr/>

    <ul>
      <li>
        <a href="/2024/projet.html">Projet Final</a>
      </li>
    </ul>

    <hr/>

    <ul>
      <li>
        <a href="/2024/honn%C3%AAtet%C3%A9.html">Honn√™tet√© Acad√©mique</a>
      </li>
      <li>
        <a href="/2024/certificat.html">Certificat CS50</a>
      </li>
      <li>
        <a href="/2024/questions-frequemment-posees.html">Questions Fr√©quemment Pos√©es</a>
      </li>
      <li>
        <a href="https://cs50.me/cs50x">Carnet de Notes</a>
      </li>
      <li>
        <a href="/2024/equipe.html">√âquipe</a>
      </li>
      <li>
        <a href="/2024/plan-de-cours.html">Plan de Cours</a>
      </li>
    </ul>
    <hr/>

    <ul>
      <li>
        <a href="/manual/index.html">Pages du Manuel</a>
      </li>
      <li>
        <a href="/2024/style.html">Guide de Style</a>
      </li>
    </ul>
  </nav>
</aside>
        <main class="col-md markdown-body">
          

  <h2>Lecture 9</h2>
<ul>
<li><a href="#welcome">Bienvenue¬†!</a></li>
<li><a href="#static-to-dynamic">Statique vers Dynamique</a></li>
<li><a href="#flask">Flask</a></li>
<li><a href="#layout">Mise en page</a></li>
<li><a href="#post">POST</a></li>
<li><a href="#frosh-ims">Frosh IMs</a></li>
<li><a href="#flask-and-sql">Flask et SQL</a></li>
<li><a href="#session">Session</a></li>
<li><a href="#store">Store</a></li>
<li><a href="#api">API</a></li>
<li><a href="#json">JSON</a></li>
<li><a href="#summing-up">R√©sum√©</a></li>
</ul>
<h2>Bienvenue¬†!</h2>
<ul>
<li>Au cours des semaines pr√©c√©dentes, vous avez appris de nombreux langages de programmation, techniques et strat√©gies.</li>
<li>En effet, ce cours a √©t√© bien moins un <em>cours C</em> ou <em>Python</em> qu'un <em>cours de programmation</em>, afin que vous puissiez suivre les futures tendances.</li>
<li>Ces derni√®res semaines, vous avez appris <em>comment apprendre</em> √†¬†programmer.</li>
<li>Aujourd‚Äôhui, nous allons passer du HTML et CSS au CSS, √† SQL, √† Python et √† JavaScript pour que vous puissiez cr√©er vos propres applications Web.</li>
</ul>
<h2>Statique vers Dynamique</h2>
<ul>
<li>Jusqu‚Äô√† pr√©sent, tout le HTML que vous avez vu √©tait pr√©√©crit et statique.</li>
<li>Dans le pass√©, lorsque vous visitiez une page, le navigateur t√©l√©chargeait une page HTML que vous pouviez consulter.</li>
<li>Les pages dynamiques font r√©f√©rence √† la capacit√© de Python et des langages similaires √† cr√©er des fichiers HTML √† la vol√©e. Par cons√©quent, vous pouvez avoir des pages Web g√©n√©r√©es par des options s√©lectionn√©es par votre utilisateur.</li>
<li>Vous avez d√©j√† utilis√© <code>http-server</code> pour fournir vos pages Web. Aujourd‚Äôhui, nous allons utiliser un nouveau serveur qui peut analyser une adresse Web et ex√©cuter des actions en fonction de l‚ÄôURL fournie.</li>
</ul>
<h2>Flask</h2>
<ul>
<li><em>Flask</em> est une biblioth√®que tierce qui vous permet d‚Äôh√©berger des applications Web √† l‚Äôaide du cadre Flask dans Python.</li>
<li>Vous pouvez ex√©cuter flask en ex√©cutant <code>flask run</code>.</li>
<li>Pour ce faire, vous aurez besoin d‚Äôun fichier appel√© <code>app.py</code> et d‚Äôun dossier appel√© <code>templates</code>.</li>
<li>
<p>Pour commencer, cr√©ez un dossier appel√© <code>templates</code> et cr√©ez un fichier appel√© <code>index.html</code> avec le code suivant¬†:</p>
<pre><code>  &lt;!DOCTYPE html&gt;

  &lt;html lang="en"&gt;
      &lt;head&gt;
          &lt;meta name="viewport" content="initial-scale=1, width=device-width"&gt;
          &lt;title&gt;hello&lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;
          hello, {{ name }}
      &lt;/body&gt;
  &lt;/html&gt;
</code></pre>
<p>Remarquez le double <code>{{ name }}</code> qui est un espace r√©serv√© pour quelque chose qui sera fourni plus tard par notre serveur Flask.</p>
</li>
<li>
<p>Ensuite, dans le m√™me dossier que le dossier <code>templates</code>, cr√©ez un fichier appel√© <code>app.py</code> et ajoutez le code suivant¬†:</p>
<pre><code>  # Salue l'utilisateur

  from flask import Flask, render_template, request

  app = Flask(__name__)

  @app.route("/")
  def index():
      return render_template("index.html", name=request.args.get("name", "world"))
</code></pre>
<p>Remarquez que ce code d√©finit <code>app</code> comme l‚Äôapplication Flask. Ensuite, il d√©finit la route <code>/</code> de <code>app</code> comme renvoyant le contenu de <code>index.html</code> avec l‚Äôargument <code>name</code>. Par d√©faut, la fonction <code>request.args.get</code> recherchera le <code>name</code> fourni par l‚Äôutilisateur. Si aucun nom n‚Äôest fourni, il choisira par d√©faut <code>world</code>.</p>
</li>
<li>
<p>Enfin, ajoutez un fichier final dans le m√™me dossier que <code>app.py</code> appel√© <code>requirements.txt</code> qui ne comporte qu'une seule ligne de code¬†:</p>
<pre><code>  Flask
</code></pre>
<p>Notez que seul <code>Flask</code> appara√Æt dans ce fichier.</p>
</li>
<li>
<p>Vous pouvez ex√©cuter ce fichier en saisissant <code>flask run</code> dans la fen√™tre du terminal. Si Flask ne s'ex√©cute pas, assurez-vous que la syntaxe de chacun des fichiers ci-dessus est correcte. De plus, si Flask ne s'ex√©cute pas, assurez-vous que vos fichiers sont organis√©s comme suit¬†:</p>
<pre><code>  /templates
      index.html
  app.py
  requirements.txt
</code></pre>
<p>Une fois que l'ex√©cution est lanc√©e, vous serez invit√© √† cliquer sur un lien. Une fois que vous acc√©dez √† cette page Web, essayez d'ajouter <code>?name=[Votre nom]</code> √† l'URL de base dans la barre d'URL de votre navigateur.</p>
</li>
<li>
<p>En am√©liorant notre programme, nous savons que la plupart des utilisateurs ne saisissent pas d'arguments dans la barre d'adresse. Au lieu de cela, les programmeurs comptent sur les utilisateurs pour remplir des formulaires sur des pages Web. En cons√©quence, nous pouvons modifier index.html comme suit¬†:</p>
<pre><code>  &lt;!DOCTYPE html&gt;

  &lt;html lang="en"&gt;
      &lt;head&gt;
          &lt;meta name="viewport" content="initial-scale=1, width=device-width"&gt;
          &lt;title&gt;hello&lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;
          &lt;form action="/greet" method="get"&gt;
              &lt;input autocomplete="off" autofocus name="name" placeholder="Name" type="text"&gt;
              &lt;button type="submit"&gt;Greet&lt;/button&gt;
          &lt;/form&gt;
      &lt;/body&gt;
  &lt;/html&gt;
</code></pre>
<p>Notez qu'un formulaire est maintenant cr√©√© qui prend le nom de l'utilisateur, puis le transmet √† une route appel√©e <code>/greet</code>.</p>
</li>
<li>
<p>De plus, nous pouvons modifier <code>app.py</code> comme suit¬†:</p>
<pre><code>  # Ajoute un formulaire, une deuxi√®me route

  from flask import Flask, render_template, request

  app = Flask(__name__)

  @app.route("/")
  def index():
      return render_template("index.html")

  @app.route("/greet")
  def greet():
      return render_template("greet.html", name=request.args.get("name", "world"))
</code></pre>
<p>Notez que le chemin d'acc√®s par d√©faut affiche un formulaire permettant √† l'utilisateur de saisir son nom. La route <code>/greet</code> transmet le <code>nom</code> √† cette page Web.</p>
</li>
<li>
<p>Pour finaliser cette impl√©mentation, vous aurez besoin d'un autre mod√®le pour <code>greet.html</code> comme suit¬†:</p>
<pre><code>  &lt;!DOCTYPE html&gt;

  &lt;html lang="en"&gt;
      &lt;head&gt;
          &lt;meta name="viewport" content="initial-scale=1, width=device-width"&gt;
          &lt;title&gt;hello&lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;
          hello, {{ name }}
      &lt;/body&gt;
  &lt;/html&gt;
</code></pre>
<p>Notez que cette route affichera d√©sormais le message d'accueil √† l'utilisateur, suivi de son nom.</p>
</li>
</ul>
<h2>Disposition</h2>
<ul>
<li>Nos deux pages Web, <code>index.html</code> et <code>greet.html</code>, poss√®dent en grande partie les m√™mes donn√©es. Ne serait-il pas appr√©ciable de permettre au corps d'√™tre unique, mais de copier la m√™me disposition de page en page¬†?</li>
<li>
<p>Tout d'abord, cr√©ez un nouveau mod√®le appel√© <code>layout.html</code> et √©crivez le code suivant¬†:</p>
<pre><code>  &lt;!DOCTYPE html&gt;

  &lt;html lang="en"&gt;
      &lt;head&gt;
          &lt;meta name="viewport" content="initial-scale=1, width=device-width"&gt;
          &lt;title&gt;hello&lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;
          {% block body %}{% endblock %}
      &lt;/body&gt;
  &lt;/html&gt;
</code></pre>
<p>Notez que <code>{% block body %}{% endblock %}</code> permet l'insertion d'un autre code provenant d'autres fichiers HTML.</p>
</li>
<li>
<p>Ensuite, modifiez votre <code>index.html</code> comme suit¬†:</p>
<pre><code>  {% extends "layout.html" %}

  {% block body %}

      &lt;form action="/greet" method="post"&gt;
          &lt;input autocomplete="off" autofocus name="name" placeholder="Name" type="text"&gt;
          &lt;button type="submit"&gt;Greet&lt;/button&gt;
      &lt;/form&gt;

  {% endblock %}
</code></pre>
<p>Notez que la ligne <code>{% extends "layout.html" %}</code> indique au serveur o√π obtenir la disposition de cette page. Puis, <code>{% block body %}{% endblock %}</code> indique quel code ins√©rer dans <code>layout.html</code>.</p>
</li>
<li>
<p>Enfin, modifiez <code>greet.html</code> comme suit¬†:</p>
<pre><code>  {% extends "layout.html" %}

  {% block body %}
      hello, {{ name }}
  {% endblock %}
</code></pre>
<p>Remarquez comme ce code est plus court et concis.</p>
</li>
</ul>
<h2>POST</h2>
<ul>
<li>Vous pouvez imaginer des sc√©narios o√π il n'est pas s√ªr d'utiliser <code>get</code>, car les noms d'utilisateur et les mots de passe appara√Ætront dans l'URL.</li>
<li>
<p>Nous pouvons utiliser la m√©thode <code>post</code> pour r√©soudre ce probl√®me en modifiant <code>app.py</code> comme suit¬†:</p>
<pre><code>  # Bascule vers POST

  from flask import Flask, render_template, request

  app = Flask(__name__)

  @app.route("/")
  def index():
      return render_template("index.html")

  @app.route("/greet", methods=["POST"])
  def greet():
      return render_template("greet.html", name=request.form.get("name", "world"))
</code></pre>
<p>Remarquez que <code>POST</code> est ajout√© √† la route <code>/greet</code> et que nous utilisons <code>request.form.get</code> plut√¥t que <code>request.args.get</code>.</p>
</li>
<li>
<p>Cela indique au serveur de rechercher <em>plus en profondeur</em> dans l'enveloppe virtuelle et de ne pas d√©voiler les √©l√©ments dans <code>post</code> dans l'URL.</p>
</li>
<li>
<p>N√©anmoins, ce code peut √™tre am√©lior√© en utilisant une seule route pour <code>get</code> et <code>post</code>. Pour ce faire, modifiez <code>app.py</code> comme suit¬†:</p>
<pre><code>  # Utilise une seule route

  from flask import Flask, render_template, request

  app = Flask(__name__)

  @app.route("/", methods=["GET", "POST"])
  def index():
      if request.method == "POST":
          return render_template("greet.html", name=request.form.get("name", "world"))
      return render_template("index.html")
</code></pre>
<p>Remarquez que <code>get</code> et <code>post</code> sont tous deux effectu√©s dans un seul routage. Cependant, <code>request.method</code> est utilis√© pour router correctement en fonction du type de routage demand√© par l'utilisateur.</p>
</li>
</ul>
<h2>Frosh IM</h2>
<ul>
<li>Frosh IM ou <em>froshims</em> est une application Web qui permet aux √©tudiants de s'inscrire √† des sports intra-muros.</li>
<li>
<p>Cr√©ez un dossier en tapant <code>mkdir froshims</code> dans la fen√™tre du terminal. Puis, tapez <code>cd froshims</code> pour naviguer vers ce dossier. √Ä l'int√©rieur, cr√©ez un r√©pertoire appel√© templates en tapant <code>mkdir templates</code>. Enfin, tapez <code>code app.py</code> et √©crivez le code suivant¬†:</p>
<pre><code>  # Impl√©mente un formulaire d'inscription √† l'aide d'un menu de s√©lection

  from flask import Flask, render_template, request

  app = Flask(__name__)

  SPORTS = [
      "Basketball",
      "Soccer",
      "Ultimate Frisbee"
  ]

  @app.route("/")
  def index():
      return render_template("index.html", sports=SPORTS)

  @app.route("/register", methods=["POST"])
  def register():

      # Valider la soumission
      if not request.form.get("name") or request.form.get("sport") not in SPORTS:
          return render_template("failure.html")

      # Confirmer l'inscription
      return render_template("success.html")
</code></pre>
<p>Notez qu'une option <code>echec</code> est fournie, de telle sorte qu'un message d'√©chec s'affiche pour l'utilisateur si le champ <code>nom</code> ou <code>sport</code> n'est pas correctement rempli.</p>
</li>
<li>
<p>Ensuite, cr√©ez un fichier dans le dossier <code>templates</code> appel√© <code>index.html</code> en tapant <code>code templates/index.html</code> et √©crivez le code suivant¬†:</p>
<pre><code>  {% extends "layout.html" %}

  {% block body %}
      &lt;h1&gt;Register&lt;/h1&gt;
      &lt;form action="/register" method="post"&gt;
          &lt;input autocomplete="off" autofocus name="name" placeholder="Name" type="text"&gt;
          &lt;select name="sport"&gt;
              &lt;option disabled selected&gt;Sport&lt;/option&gt;
              {% for sport in sports %}
                  &lt;option value="{{ sport }}"&gt;{{ sport }}&lt;/option&gt;
              {% endfor %}
          &lt;/select&gt;
          &lt;button type="submit"&gt;Register&lt;/button&gt;
      &lt;/form&gt;
  {% endblock %}
</code></pre>
</li>
<li>
<p>Ensuite, cr√©ez un fichier appel√© <code>layout.html</code> en tapant <code>code templates/layout.html</code> et √©crivez le code suivant¬†:</p>
<pre><code>  &lt;!DOCTYPE html&gt;

  &lt;html lang="en"&gt;
      &lt;head&gt;
          &lt;meta name="viewport" content="initial-scale=1, width=device-width"&gt;
          &lt;title&gt;froshims&lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;
          {% block body %}{% endblock %}
      &lt;/body&gt;
  &lt;/html&gt;
</code></pre>
</li>
<li>
<p>Quatri√®mement, cr√©ez un fichier dans les mod√®les appel√©s <code>success.html</code> comme suit¬†:</p>
<pre><code>  {% extends "layout.html" %}

  {% block body %}
      You are registered!
  {% endblock %}
</code></pre>
</li>
<li>
<p>Enfin, cr√©ez un fichier dans les mod√®les appel√©s <code>failure.html</code> comme suit¬†:</p>
<pre><code>  {% extends "layout.html" %}

  {% block body %}
      You are not registered!
  {% endblock %}
</code></pre>
</li>
<li>
<p>Vous pouvez imaginer que nous pourrions accepter l'inscription de diff√©rents inscrits. Nous pouvons am√©liorer <code>app.py</code> comme suit¬†:</p>
<pre><code>  # Impl√©mente un formulaire d'inscription, stockant les inscrits dans un dictionnaire, avec des messages d'erreur

  de flask importe Flask, redirection, render_template, demande

  application¬†=¬†Flacon (__name__)

  INSCRITS¬†=¬†{}

  SPORTS¬†=¬†[
      ¬´¬†Basketball¬†¬ª,
      ¬´¬†Football¬†¬ª,
      ¬´¬†Ultimate Frisbee¬†¬ª
  ]

  @application.route (¬´¬†/¬†¬ª)
  def index()¬†:
      renvoyer render_template (¬´¬†index.html¬†¬ª, sports=SPORTS)

  @application.route (¬´¬†/¬†inscrire¬†¬ª)
  def enregistrer()¬†:

      # Valider le nom
      nom¬†=¬†demander.formule.obtenir (¬´¬†nom¬†¬ª)
      si pas nom¬†:
          retourne render_template (¬´¬†error.html¬†¬ª, message=¬´¬†Nom manquant¬†¬ª)

      # Valider le sport
      sport¬†=¬†demander.formule.obtenir (¬´¬†sport¬†¬ª)
      si pas sport¬†:
          retourne render_template (¬´¬†error.html¬†¬ª, message=¬´¬†Sport manquant¬†¬ª)
      si le sport n'est pas dans les SPORTS¬†:
          retourne render_template (¬´¬†error.html¬†¬ª, message=¬´¬†Sport non valide¬†¬ª)

      # M√©moriser l'inscrit
      INSCRITS [nom]¬†=¬†sport

      # Confirmer l'inscription
      retourner la redirection (¬´¬†/¬†inscrits¬†¬ª)

  @application.route (¬´¬†/¬†inscrits¬†¬ª)
  def inscrits()¬†:
      renvoyer render_template (¬´¬†registrants.html¬†¬ª, registrants=REGISTRANTS)
</code></pre>
<p>Remarquez qu'un dictionnaire appel√© <code>REGISTRANTS</code> est utilis√© pour enregistrer le sport s√©lectionn√© par <code>REGISTRANTS[name]</code>. Remarquez √©galement que <code>registrants=REGISTRANTS</code> transmet le dictionnaire √† ce mod√®le.</p>
</li>
<li>
<p>En outre, cr√©ez un nouveau mod√®le appel√© <code>registrants.html</code> comme suit¬†:</p>
<pre><code>  {%¬†√©tend ¬´¬†layout.html¬†¬ª¬†%}

  {%¬†block¬†body¬†%}
      &lt;h1&gt;Inscrits&lt;/h1&gt;
      &lt;table&gt;
          &lt;thead&gt;
              &lt;tr&gt;
                  &lt;th&gt;Nom&lt;/th&gt;
                  &lt;th&gt;Sport&lt;/th&gt;
              &lt;/tr&gt;
          &lt;/thead&gt;
          &lt;tbody&gt;
              {% pour nom dans les inscrits %}
                  &lt;tr&gt;
                      &lt;td&gt;{{ nom }}&lt;/td&gt;
                      &lt;td&gt;{{inscrits[nom]}}&lt;/td&gt;
                  &lt;/tr&gt;
              {% fin pour %}
          &lt;/tbody&gt;
      &lt;/table&gt;
  {%¬†fin¬†du¬†bloc¬†%}
</code></pre>
<p>Remarquez que <code>{% pour nom dans les inscrits %}...{% fin pour %}</code> it√©rera sur chacun des inscrits. Tr√®s puissant de pouvoir it√©rer sur une page Web dynamique¬†!</p>
</li>
<li>
<p>En ex√©cutant <code>flask run</code> et en saisissant de nombreux noms et sports, vous pouvez acc√©der √† <code>/registrants</code> pour afficher les donn√©es qui ont √©t√© enregistr√©es.</p>
</li>
<li>Vous avez maintenant une application Web¬†! Cependant, il existe certaines failles de s√©curit√©¬†! √âtant donn√© que tout se trouve c√¥t√© client, un adversaire pourrait modifier le HTML et pirater un site Web. De plus, ces donn√©es ne persisteront pas si le serveur est arr√™t√©. Pourrait-il y avoir un moyen de faire en sorte que nos donn√©es persistent m√™me lorsque le serveur red√©marre¬†?</li>
</ul>
<h2>Flask et SQL</h2>
<ul>
<li>Tout comme nous avons vu comment Python peut s'interfacer avec une base de donn√©es SQL, nous pouvons combiner la puissance de Flask, Python et SQL pour cr√©er une application web dans laquelle les donn√©es persisteront !</li>
<li>Pour mettre cela en ≈ìuvre, vous devrez prendre un certain nombre de mesures.</li>
<li>
<p>Tout d'abord, modifiez requirements.txt comme suit :</p>
<pre><code>  cs50
  Flask
</code></pre>
</li>
<li>
<p>Modifiez index.html comme suit :</p>
<pre><code>  {% extends "layout.html" %}

  {% block body %}
      &lt;h1&gt;S'inscrire&lt;/h1&gt;
      &lt;form action="/register" method="post"&gt;
          &lt;input autocomplete="off" autofocus name="name" placeholder="Nom" type="text"&gt;
          {% for sport in sports %}
              &lt;input name="sport" type="radio" value="{{ sport }}"&gt; {{ sport }}
          {% endfor %}
          &lt;button type="submit"&gt;S'inscrire&lt;/button&gt;
      &lt;/form&gt;
  {% endblock %}
</code></pre>
</li>
<li>
<p>Modifiez layout.html comme suit :</p>
<pre><code>  &lt;!DOCTYPE html&gt;

  &lt;html lang="en"&gt;
      &lt;head&gt;
          &lt;meta name="viewport" content="initial-scale=1, width=device-width"&gt;
          &lt;title&gt;froshims&lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;
          {% block body %}{% endblock %}
      &lt;/body&gt;
  &lt;/html&gt;
</code></pre>
</li>
<li>
<p>Assurez-vous que failure.html appara√Æt comme suit :</p>
<pre><code>  {% extends "layout.html" %}

  {% block body %}
      Vous n'√™tes pas inscrit !
  {% endblock %}
</code></pre>
</li>
<li>
<p>Modifiez registrants.html pour qu'il apparaisse comme suit :</p>
<pre><code>  {% extends "layout.html" %}

  {% block body %}
      &lt;h1&gt;Inscrits&lt;/h1&gt;
      &lt;table&gt;
          &lt;thead&gt;
              &lt;tr&gt;
                  &lt;th&gt;Nom&lt;/th&gt;
                  &lt;th&gt;Sport&lt;/th&gt;
                  &lt;th&gt;&lt;/th&gt;
              &lt;/tr&gt;
          &lt;/thead&gt;
          &lt;tbody&gt;
              {% for registrant in registrants %}
                  &lt;tr&gt;
                      &lt;td&gt;{{ registrant.name }}&lt;/td&gt;
                      &lt;td&gt;{{ registrant.sport }}&lt;/td&gt;
                      &lt;td&gt;
                          &lt;form action="/deregister" method="post"&gt;
                              &lt;input name="id" type="hidden" value="{{ registrant.id }}"&gt;
                              &lt;button type="submit"&gt;Se d√©sinscrire&lt;/button&gt;
                          &lt;/form&gt;
                      &lt;/td&gt;
                  &lt;/tr&gt;
              {% endfor %}
          &lt;/tbody&gt;
      &lt;/table&gt;
  {% endblock %}
</code></pre>
<p>Notez qu'une valeur cach√©e <code>registrant.id</code> est incluse pour qu'il soit possible d'utiliser cet <code>id</code> plus tard dans <code>app.py</code></p>
</li>
<li>
<p>Enfin, modifiez <code>app.py</code> comme suit :</p>
<pre><code>  # Impl√©mente un formulaire d'inscriptions, stockant les inscrits dans une base de donn√©es SQLite, avec option de d√©sinscription

  de cs50 import SQL
  de flask import Flask, redirect, render_template, request

  app = Flask(__name__)

  db = SQL("sqlite:///froshims.db")

  SPORTS = [
      "Basketball",
      "Soccer",
      "Ultimate Frisbee"
  ]

  @app.route("/")
  def index():
      return render_template("index.html", sports=SPORTS)

  @app.route("/deregister", m√©thodes=["POST"])
  def deregister():

      # Oublie l'inscrit
      id = request.form.get("id")
      si id :
          db.execute("DELETE FROM registrants WHERE id = ?", id)
      return redirect("/registrants")

  @app.route("/register", m√©thodes=["POST"])
  def register():

      # Valide la soumission
      nom = request.form.get("nom")
      sport = request.form.get("sport")
      si pas nom ou sport pas dans SPORTS :
          return render_template("failure.html")

      # Se souviens de l'inscrit
      db.execute("INSERT INTO registrants (nom, sport) VALUES(?, ?)", nom, sport)

      # Confirme l'inscription
      return redirect("/registrants")

  @app.route("/registrants")
  def registrants():
      inscrits = db.execute("SELECT * FROM registrants")
      return render_template("registrants.html", inscrits=inscrits)
</code></pre>
<p>Notez que la biblioth√®que <code>cs50</code> est utilis√©e. Une route est incluse pour <code>register</code> pour la m√©thode <code>post</code>. Cette route prendra le nom et le sport pris dans le formulaire d'inscription et ex√©cutera une requ√™te SQL pour ajouter le <code>nom</code> et le <code>sport</code> √† la table <code>registrants</code>. La route <code>deregister</code> est reli√©e √† une requ√™te SQL qui r√©cup√©rera l'identifiant de l'utilisateur et utilisera cette information pour le d√©sinscrire.</p>
</li>
<li>
<p>Vous pouvez en lire plus dans la <a href="https://flask.palletsprojects.com">documentation Flask</a>.</p>
</li>
</ul>
<h2>S√©ance</h2>
<ul>
<li>Bien que le code ci-dessus soit utile du point de vue administratif, o√π un administrateur du back-office pourrait ajouter et supprimer des personnes de la base de donn√©es, on peut imaginer que ce code n'est pas s√ªr √† impl√©menter sur un serveur public.</li>
<li>D'une part, de mauvais acteurs pourraient prendre des d√©cisions au nom d'autres utilisateurs en appuyant sur le bouton de d√©sinscription, supprimant ainsi efficacement leur r√©ponse enregistr√©e du serveur.</li>
<li>Les services Web comme Google utilisent les informations d'identification de connexion pour s'assurer que les utilisateurs n'ont acc√®s qu'aux bonnes donn√©es.</li>
<li>Nous pouvons en fait impl√©menter cela nous-m√™mes √† l'aide de <em>cookies</em>. Les cookies sont de petits fichiers qui sont stock√©s sur votre ordinateur, de sorte que votre ordinateur puisse communiquer avec le serveur et dire effectivement¬†: ¬´¬†Je suis un utilisateur autoris√© qui s'est d√©j√† connect√©¬†¬ª.</li>
<li>Dans la forme la plus simple, nous pouvons impl√©menter cela en cr√©ant un dossier appel√© <code>login</code>, puis en ajoutant les fichiers suivants.</li>
<li>
<p>Tout d'abord, cr√©ez un fichier appel√© <code>requirements.txt</code> qui se lit comme suit¬†:</p>
<pre><code>  Flask
  Flask-Session
</code></pre>
<p>Notez qu'en plus de <code>Flask</code>, nous incluons √©galement <code>Flask-Session</code>, qui est n√©cessaire pour prendre en charge les sessions de connexion.</p>
</li>
<li>
<p>Deuxi√®mement, dans un dossier <code>templates</code>, cr√©ez un fichier appel√© <code>layout.html</code> qui appara√Æt comme suit¬†:</p>
<pre><code>  &lt;!DOCTYPE html&gt;

  &lt;html lang="en"&gt;
      &lt;head&gt;
          &lt;meta name="viewport" content="initial-scale=1, width=device-width"&gt;
          &lt;title&gt;store&lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;
          {% block body %}{% endblock %}
      &lt;/body&gt;
  &lt;/html&gt;
</code></pre>
<p>Notez que cela fournit une mise en page tr√®s simple avec un titre et un corps.</p>
</li>
<li>
<p>Troisi√®mement, cr√©ez un fichier dans le dossier <code>templates</code> appel√© <code>index.html</code> qui appara√Æt comme suit¬†:</p>
<pre><code>  {% extends "layout.html" %}

  {% block body %}

      {% if session["name"] %}
          Vous √™tes connect√© en tant que {{ session["name"] }}. &lt;a href="/logout"&gt;D√©connexion&lt;/a&gt;.
      {% else %}
          Vous n'√™tes pas connect√©. &lt;a href="/login"&gt;Connectez-vous&lt;/a&gt;.
      {% endif %}

  {% endblock %}
</code></pre>
<p>Notez que ce fichier regarde si <code>session["name"]</code> existe. Si c'est le cas, il affichera un message de bienvenue. Sinon, il vous recommandera de parcourir une page pour vous connecter.</p>
</li>
<li>
<p>Quatri√®mement, cr√©ez un fichier appel√© <code>login.html</code> et ajoutez le code suivant¬†:</p>
<pre><code>  {% extends "layout.html" %}

  {% block body %}

      &lt;form action="/login" method="post"&gt;
          &lt;input autocomplete="off" autofocus name="name" placeholder="Nom" type="text"&gt;
          &lt;button type="submit"&gt;Connexion&lt;/button&gt;
      &lt;/form&gt;

  {% endblock %}
</code></pre>
<p>Notez qu'il s'agit de la mise en page d'une page de connexion basique.</p>
</li>
<li>
<p>Finalement, cr√©ez un fichier dans le dossier <code>login</code> appel√© <code>app.py</code> et √©crivez le code comme suit¬†:</p>
<pre><code>  from flask import Flask, redirect, render_template, request, session
  from flask_session import Session

  # Configurer l'application
  app = Flask(__name__)

  # Configurer la session
  app.config["SESSION_PERMANENT"] = False
  app.config["SESSION_TYPE"] = "filesystem"
  Session(app)

  @app.route("/")
  def index():
      if not session.get("name"):
          return redirect("/login")
      return render_template("index.html")

  @app.route("/login", methods=["GET", "POST"])
  def login():
      if request.method == "POST":
          session["name"] = request.form.get("name")
          return redirect("/")
      return render_template("login.html")

  @app.route("/logout")
  def logout():
      session["name"] = None
      return redirect("/")
</code></pre>
<p>Notez les <em>imports</em> modifi√©s en haut du fichier, y compris <code>session</code>, qui vous permettra de prendre en charge les sessions. Le plus important, c'est comment <code>session["name"]</code> est utilis√© dans les chemins <code>login</code> et <code>logout</code>. Le chemin <code>login</code> attribuera le nom de connexion fourni et l'attribuera √† <code>session["name"]</code>. Cependant, dans le chemin <code>logout</code>, la d√©connexion est impl√©ment√©e en d√©finissant simplement <code>session["name"]</code> √† <code>None</code>.</p>
</li>
<li>
<p>Vous pouvez en savoir plus sur les sessions dans la <a href="https://flask.palletsprojects.com/en/2.2.x/api/?highlight=session#flask.session">documentation Flask</a>.</p>
</li>
</ul>
<h2>Magasin</h2>
<ul>
<li>Passons √† un exemple final de l'utilisation de la capacit√© de Flask √† activer une session.</li>
<li>
<p>Nous avons examin√© le code suivant pour <code>store</code> dans <code>app.py</code>. Le code suivant √©tait affich√©¬†:</p>
<pre><code>  from cs50 import SQL
  from flask import Flask, redirect, render_template, request, session
  from flask_session import Session

  # Configurer l'application
  app = Flask(__name__)

  # Se connecter √† la base de donn√©es
  db = SQL("sqlite:///store.db")

  # Configurer la session
  app.config["SESSION_PERMANENT"] = False
  app.config["SESSION_TYPE"] = "filesystem"
  Session(app)

  @app.route("/")
  def index():
      books = db.execute("SELECT * FROM books")
      return render_template("books.html", books=books)

  @app.route("/cart", methods=["GET", "POST"])
  def cart():

      # S'assurer que le panier existe
      if "cart" not in session:
          session["cart"] = []

      # POST
      if request.method == "POST":
          id = request.form.get("id")
          if id:
              session["cart"].append(id)
          return redirect("/cart")

      # GET
      books = db.execute("SELECT * FROM books WHERE id IN (?)", session["cart"])
      return render_template("cart.html", books=books)
</code></pre>
<p>Notez que <code>cart</code> est impl√©ment√© √† l'aide d'une liste. Les √©l√©ments peuvent √™tre ajout√©s √† cette liste √† l'aide des boutons <code>Ajouter au panier</code> dans <code>books.html</code>. Lorsque vous cliquez sur un tel bouton, la m√©thode <code>post</code> est invoqu√©e, o√π le <code>id</code> de l'√©l√©ment est ajout√© au <code>panier</code>. Lors de la visualisation du panier, on invoque la m√©thode <code>get</code>, SQL est ex√©cut√© pour afficher une liste des livres dans le panier.</p>
</li>
</ul>
<h2>API</h2>
<ul>
<li>Une <em>interface de programmation d'applications</em> ou <em>API</em> est une s√©rie de sp√©cifications qui vous permettent d'interagir avec un autre service. Par exemple, nous pourrions utiliser l'API d'IMDB pour interagir avec leur base de donn√©es. Nous pourrions m√™me int√©grer des API pour g√©rer des types sp√©cifiques de donn√©es t√©l√©chargeables depuis un serveur.</li>
<li>Nous avons examin√© un exemple appel√© <code>shows</code>.</li>
<li>
<p>En examinant <code>app.py</code>, nous avons vu ce qui suit :</p>
<pre><code>  # Recherches des s√©ries √† l'aide d'Ajax

  from cs50 import SQL
  from flask import Flask, render_template, request

  app = Flask(__name__)

  db = SQL("sqlite:///shows.db")

  @app.route("/")
  def index():
      return render_template("index.html")

  @app.route("/search")
  def search():
      q = request.args.get("q")
      if q:
          shows = db.execute("SELECT * FROM shows WHERE title LIKE ? LIMIT 50", "%" + q + "%")
      else:
          shows = []
      return render_template("search.html", shows=shows)
</code></pre>
<p>Notez que la route <code>search</code> ex√©cute une requ√™te SQL.</p>
</li>
<li>
<p>En examinant <code>search.html</code>, vous remarquerez que c'est tr√®s simple :</p>
<pre><code>  {% for show in shows %}
      &lt;li&gt;{{ show["title"] }}&lt;/li&gt;
  {% endfor %}
</code></pre>
<p>Notez qu'il fournit une liste √† puces.</p>
</li>
<li>
<p>Enfin, en examinant <code>index.html</code>, notez que le code <em>AJAX</em> est utilis√© pour alimenter la recherche :</p>
<pre><code>  &lt;!DOCTYPE html&gt;

  &lt;html lang="en"&gt;
      &lt;head&gt;
          &lt;meta name="viewport" content="initial-scale=1, width=device-width"&gt;
          &lt;title&gt;shows&lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;

          &lt;input autocomplete="off" autofocus placeholder="Requ√™te" type="search"&gt;

          &lt;ul&gt;&lt;/ul&gt;

          &lt;script&gt;

              let input = document.querySelector('input');
              input.addEventListener('input', async function() {
                  let response = await fetch('/search?q=' + input.value);
                  let shows = await response.text();
                  document.querySelector('ul').innerHTML = shows;
              });

          &lt;/script&gt;

      &lt;/body&gt;
  &lt;/html&gt;
</code></pre>
<p>Notez qu'un √©couteur d'√©v√©nements est utilis√© pour interroger dynamiquement le serveur afin de fournir une liste correspondant au titre fourni. Cela localisera la balise <code>ul</code> dans le code HTML et modifiera la page Web en cons√©quence pour inclure la liste des correspondances.</p>
</li>
<li>
<p>Vous pouvez en savoir plus dans la <a href="https://api.jquery.com/category/ajax/">documentation AJAX</a>.</p>
</li>
</ul>
<h2>JSON</h2>
<ul>
<li><em>JavaScript Object Notation</em> ou <em>JSON</em> est un fichier texte de dictionnaires avec des cl√©s et des valeurs. C'est une mani√®re brute et conviviale pour obtenir de nombreuses donn√©es.</li>
<li>JSON est un moyen tr√®s utile de r√©cup√©rer des donn√©es depuis le serveur.</li>
<li>
<p>Vous pouvez le voir en action dans le fichier <code>index.html</code> que nous avons examin√© ensemble¬†:</p>
<pre><code>  &lt;!DOCTYPE html&gt;

  &lt;html lang="en"&gt;
      &lt;head&gt;
          &lt;meta name="viewport" content="initial-scale=1, width=device-width"&gt;
          &lt;title&gt;shows&lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;

          &lt;input autocomplete="off" autofocus placeholder="Query" type="text"&gt;

          &lt;ul&gt;&lt;/ul&gt;

          &lt;script&gt;

              let input = document.querySelector('input');
              input.addEventListener('input', async function() {
                  let response = await fetch('/search?q=' + input.value);
                  let shows = await response.json();
                  let html = '';
                  for (let id in shows) {
                      let title = shows[id].title.replace('&lt;', '&amp;lt;').replace('&amp;', '&amp;amp;');
                      html += '&lt;li&gt;' + title + '&lt;/li&gt;';
                  }
                  document.querySelector('ul').innerHTML = html;
              });

          &lt;/script&gt;

      &lt;/body&gt;
  &lt;/html&gt;
</code></pre>
<p>Bien que le code ci-dessus puisse sembler quelque peu cryptique, il vous fournit un point de d√©part pour que vous puissiez effectuer des recherches sur JSON par vous-m√™me afin de voir comment celui-ci peut √™tre impl√©ment√© dans vos propres applications Web.</p>
</li>
<li>
<p>Vous pouvez en lire plus dans la <a href="https://www.json.org/json-en.html">documentation JSON</a>.</p>
</li>
</ul>
<h2>R√©sum√©</h2>
<p>Dans cette le√ßon, vous avez appris comment utiliser Python, SQL et Flask pour cr√©er des applications Web. Plus pr√©cis√©ment, nous avons abord√©‚Ä¶</p>
<ul>
<li>GET</li>
<li>POST</li>
<li>Flask</li>
<li>Session</li>
<li>AJAX</li>
<li>JSON</li>
</ul>
<p>√Ä bient√¥t pour notre conf√©rence finale¬†!</p>


        </main>
      </div>
    </div>
  </body>

</html>