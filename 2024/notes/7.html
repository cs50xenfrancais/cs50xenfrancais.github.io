<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>CS50x en Fran√ßais</title>

    <!-- http://getbootstrap.com/docs/4.5/getting-started/introduction/ -->
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/popper.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>

    <!-- https://momentjs.com/, https://momentjs.com/timezone/ -->
    <script src="/static/js/moment.min.js"></script>
    <script src="/static/js/moment-timezone-with-data.min.js"></script>
    <script src="/static/js/luxon.min.js"></script>

    <!-- https://www.algolia.com/doc/guides/building-search-ui/installation/js/ -->
    <script src="/static/js/algoliasearchLite.min.js"></script>
    <script src="/static/js/instantsearch.production.min.js"></script>
    <script src="/static/js/jekyll-theme-cs50.js"></script>

    <script id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="/static/highlight/highlight.min.js"></script>
    <script>
      hljs.initHighlightingOnLoad();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.8.0/dist/mermaid.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/static/highlight/styles/vs.min.css"/>
    <link rel="stylesheet" href="/static/css/page.css">

    <style>
      code {
        color: black;
        border: 1px solid #dee2e6;
      }

      pre > code {
        padding: 0 !important;
      }

      pre {
        border: 1px solid #dee2e6;
      }

      .mermaid {
        background-color: white !important;
        border: none !important;
      }
    </style>
  </head>

  <body>
    <!-- Markdown Flux Diagrams -->
    <script type="module">
      mermaid.initialize({startOnLoad: true});
    </script>
    <div class="container-fluid">
      <div class="row">
        <aside class="col-md" style="background-color: darkblue">
  <header>
    <h1>
      <a href="">CS50x en Fran√ßais</a>
    </h1>

    <p>
      <a target="_blank" href=""></a>
      <br/>
      2024
    </p>
  </header>

  <button class="btn btn-sm collapsed d-md-none" aria-controls="nav" aria-expanded="false" data-target="aside &gt; nav" data-toggle="collapse">
    Menu
  </button>

  <nav class="collapse d-md-block" id="nav">
    <hr/>

    <ul>
      <li>
        <a href="/2024/semaines/0.html">Semaine
          0</a>
        Scratch üò∫
      </li>
      <li>
        <a href="/2024/semaines/1.html">Semaine
          1</a>
        C
      </li>
      <li>
        <a href="/2024/semaines/2.html">Semaine
          2</a>
        Tableaux
      </li>
      <li>
        <a href="/2024/semaines/3.html">Semaine
          3</a>
        Algorithmes
      </li>
      <li>
        <a href="/2024/semaines/4.html">Semaine
          4</a>
        M√©moire
      </li>
      <li>
        <a href="/2024/semaines/5.html">Semaine
          5</a>
        Structures de Donn√©es
      </li>
      <li>
        <a href="/2024/semaines/6.html">Semaine
          6</a>
        Python
      </li>
      <li>
        <a href="/2024/semaines/7.html">Semaine
          7</a>
        SQL
      </li>
      <li>
        <a href="/2024/semaines/8.html">Semaine
          8</a>
        HTML, CSS, JavaScript
      </li>
      <li>
        <a href="/2024/semaines/9.html">Semaine
          9</a>
        Flask
      </li>
      <li>
        <a href="/2024/semaines/10.html">Semaine
          10</a>
        Cybers√©curit√©
      </li>
    </ul>

    <hr/>

    <ul>
      <li>
        <a href="/2024/projet.html">Projet Final</a>
      </li>
    </ul>

    <hr/>

    <ul>
      <li>
        <a href="/2024/honn%C3%AAtet%C3%A9.html">Honn√™tet√© Acad√©mique</a>
      </li>
      <li>
        <a href="/2024/certificat.html">Certificat CS50</a>
      </li>
      <li>
        <a href="/2024/questions-frequemment-posees.html">Questions Fr√©quemment Pos√©es</a>
      </li>
      <li>
        <a href="https://cs50.me/cs50x">Carnet de Notes</a>
      </li>
      <li>
        <a href="/2024/equipe.html">√âquipe</a>
      </li>
      <li>
        <a href="/2024/plan-de-cours.html">Plan de Cours</a>
      </li>
    </ul>
    <hr/>

    <ul>
      <li>
        <a href="/manual/index.html">Pages du Manuel</a>
      </li>
      <li>
        <a href="/2024/style.html">Guide de Style</a>
      </li>
    </ul>
  </nav>
</aside>
        <main class="col-md markdown-body">
          

  <h2>Lecon 7</h2>
<ul>
<li><a href="spreadsheets">Tablesur des tableurs</a></li>
<li><a href="#sql">SQL</a></li>
<li><a href="#imdb">IMDb</a></li>
<li><a href="#multiple-tables">Plusieurs tables</a></li>
<li><a href="#problems">Probl√®mes</a></li>
</ul>
<h3>Tablesur des tableurs</h3>
<ul>
<li>Nous sommes pour la plupart familiers avec les tableurs, des lignes de donn√©es, chaque colonne d'une ligne ayant des donn√©es distinctes qui se rapportent aux autres d'une certaine fa√ßon.</li>
<li>Une base de donn√©es est une application qui peut stocker des donn√©es, et nous pouvons penser √† Google Sheets comme en √©tant une de ces applications.</li>
<li>Par exemple, nous avons cr√©√© un Google Form pour demander aux √©tudiants leur s√©rie TV pr√©f√©r√©e et son genre. Nous examinons les r√©ponses et voyons que la tableur a trois colonnes¬†: ¬´¬†Timestamp¬†¬ª, ¬´¬†titre¬†¬ª et ¬´¬†genres¬†¬ª¬†:
  <img alt="Image d'un tableur Google Sheets avec la ligne 1 ayant les cellules ¬´¬†Timestamp¬†¬ª, ¬´¬†titre¬†¬ª et ¬´¬†genres¬†¬ª, avec la ligne 2 ayant les cellules ¬´¬†28/10/2019 15:03:45¬†¬ª, ¬´¬†Dynasty¬†¬ª, ¬´¬†Drama, Family¬†¬ª, etc" src="https://cs50.harvard.edu/x/2020/notes/7/spreadsheet.png" /></li>
<li>Nous pouvons t√©l√©charger un fichier CSV du tableur avec ¬´¬†Fichier¬†¬ª &gt; ¬´¬†T√©l√©charger¬†¬ª, le t√©l√©charger dans notre IDE, et voir qu'il s'agit d'un fichier texte avec des valeurs s√©par√©es par des virgules qui correspondent aux donn√©es du tableur.</li>
<li>
<p>Nous allons √©crire <code>favorites.py</code>:</p>
<pre><code>  import csv

  with open("CS50 2019 - Lecture 7 - Favorite TV Shows (Responses) - Form Responses 1.csv", "r") as file:
      reader = csv.DictReader(file)

      for row in reader:
          print(row["title"])
</code></pre>
<ul>
<li>Nous allons simplement ouvrir le fichier et nous assurer que nous pouvons obtenir le titre de chaque ligne.</li>
</ul>
</li>
<li>
<p>Maintenant nous pouvons utiliser un dictionnaire pour compter le nombre de fois o√π nous avons vu chaque titre, avec les cl√©s √©tant les titres et les valeurs pour chaque cl√© un entier, en suivant le nombre de fois o√π nous avons vu ce titre¬†:</p>
<pre><code>  import csv

  counts = {}

  with open("CS50 2019 - Lecture 7 - Favorite TV Shows (Responses) - Form Responses 1.csv", "r") as file:
      reader = csv.DictReader(file)

      for row in reader:
          title = row["title"]
          if title in counts:
              counts[title] += 1
          else:
              counts[title] = 1

  for title, count in counts.items():
      print(title, count, sep=" | ")
</code></pre>
<ul>
<li>Dans chaque ligne, nous pouvons obtenir le <code>title</code> avec <code>row["title"]</code>.</li>
<li>Ici, si nous avons d√©j√† vu le titre (il est dans <code>counts</code>), nous pouvons simplement ajouter 1 √† la valeur. Sinon, nous devons d√©finir la valeur initiale √† 1.</li>
<li>Enfin, nous pouvons imprimer les cl√©s et les valeurs de notre dictionnaire avec un s√©parateur afin que ce soit un peu plus facile √† lire.</li>
</ul>
</li>
<li>
<p>Nous pouvons changer la mani√®re dont nous it√©rons √† <code>for title, count in sorted(counts.items())</code>, et nous verrons notre dictionnaire tri√© par les cl√©s, par ordre alphab√©tique.</p>
</li>
<li>
<p>Mais nous pouvons trier par les paires cl√©-valeur dans le dictionnaire avec¬†:</p>
<pre><code>  def f(item):
    return item[1]

  for title, count in sorted(counts.items(), key=f, reverse=True):
</code></pre>
<ul>
<li>Nous d√©finissons une fonction, <code>f</code>, qui renvoie simplement la valeur de l'√©l√©ment¬†<code>item</code> dans le dictionnaire avec <code>item[1]</code>. La fonction <code>sorted</code>, √† son tour, peut l'utiliser comme cl√© pour trier les √©l√©ments du dictionnaire. Et nous allons √©galement passer <code>reverse=True</code> pour trier du plus grand au plus petit, au lieu du plus petit au plus grand.</li>
</ul>
</li>
<li>
<p>Nous pouvons en fait d√©finir notre fonction sur la m√™me ligne, avec cette syntaxe¬†:</p>
<pre><code>  for title, count in sorted(counts.items(), key=lambda item: item[1], reverse=True):
</code></pre>
<ul>
<li>Nous passons une lambda, ou fonction anonyme, comme cl√©, qui prend en compte <code>item</code> et renvoie <code>item[1]</code>.</li>
</ul>
</li>
<li>
<p>Enfin, nous pouvons passer tous les titres en minuscules avec <code>title = row["title"].lower()</code>, afin que nos d√©comptes puissent √™tre un peu plus pr√©cis m√™me si les noms n'ont pas √©t√© saisis exactement de la m√™me mani√®re.</p>
</li>
</ul>
<h2>SQL</h2>
<ul>
<li>Nous allons nous tourner vers un nouveau programme dans notre fen√™tre de terminal, <code>sqlite3</code>, un programme en ligne de commande qui nous permet d‚Äôutiliser un autre langage, SQL (prononcer comme ¬´ s√©quel ¬ª).</li>
<li>
<p>Nous allons ex√©cuter quelques commandes pour cr√©er une nouvelle base de donn√©es nomm√©e <code>favorites.db</code> et importer notre fichier CSV dans un tableau appel√© ¬´ favoris ¬ª :</p>
<pre><code>  ~/ $ sqlite3 favorites.db
  SQLite version 3.22.0 2018-01-22 18:45:57
  Enter ".help" for usage hints.
  sqlite&gt; .mode csv
  sqlite&gt; .import "CS50 2019 - Lecture 7 - Favorite TV Shows (Responses) - Form Responses 1.csv" favorites
</code></pre>
</li>
<li>
<p>Nous voyons un <code>favorites.db</code> dans notre IDE apr√®s avoir ex√©cut√© ceci, et nous pouvons d√©sormais utiliser SQL pour interagir avec nos donn√©es :</p>
<pre><code>  sqlite&gt; SELECT title FROM favorites;
  title
  Dynasty
  The Office
  Blindspot
  24
  Friends
  psych
  Veep
  Survivor
  ...
</code></pre>
</li>
<li>
<p>Nous pouvons m√™me trier nos r√©sultats :</p>
<pre><code>  sqlite&gt; SELECT title FROM favorites ORDER BY title;
  title
  /
  24
  9009
  Adventure Time
  Airplane Repo
  Always Sunny
  Ancient Aliens
  ...
</code></pre>
</li>
<li>
<p>Et obtenir un compte du nombre de fois o√π chaque titre appara√Æt :</p>
<pre><code>  sqlite&gt; SELECT title, COUNT(title) FROM favorites GROUP BY title;
  title | COUNT(title)
  / | 1
  24 | 1
  9009 | 1
  Adventure Time | 1
  Airplane Repo | 1
  Always Sunny | 1
  Ancient Aliens | 1
  ...
</code></pre>
</li>
<li>
<p>Nous pouvons m√™me d√©finir le compte de chaque titre sur une nouvelle variable, <code>n</code>, et ordonner nos r√©sultats par celle-ci, en ordre d√©croissant. Puis nous pouvons voir les 10 premiers r√©sultats avec <code>LIMIT 10</code> :</p>
<pre><code>  sqlite&gt; SELECT title, COUNT(title) AS n FROM favorites GROUP BY title ORDER BY n DESC LIMIT 10;
  title | n
  The Office | 30
  Friends | 20
  Game of Thrones | 20
  Breaking Bad | 14
  Black Mirror | 9
  Rick and Morty | 9
  Brooklyn Nine-Nine | 5
  Game of thrones | 5
  No | 5
  Prison Break | 5
</code></pre>
</li>
<li>
<p>SQL est un langage qui nous permet de travailler avec une base de donn&eacute;es relationnelle, une application nous permet de stocker des donn&eacute;es et de travailler dessus plus rapidement qu'avec un fichier CSV.</p>
</li>
<li>
<p>Avec <code>.schema</code>, nous pouvons voir comment le format de la table pour nos donn&eacute;es est cr&eacute;&eacute;¬†:</p>
<pre><code>  sqlite&gt; .schema
  CREATE TABLE favorites(
    "Timestamp" TEXT,
    "title" TEXT,
    "genres" TEXT
  );
</code></pre>
</li>
<li>
<p>Il s'av&egrave;re que, lorsque nous travaillons avec des donn&eacute;es, nous n'avons besoin que de quatre op&eacute;rations¬†:</p>
<ul>
<li><code>CREATE</code></li>
<li><code>READ</code></li>
<li><code>UPDATE</code></li>
<li><code>DELETE</code></li>
</ul>
</li>
<li>En SQL, les commandes pour effectuer chacune de ces op&eacute;rations sont¬†:<ul>
<li><code>INSERT</code></li>
<li><code>SELECT</code></li>
<li><code>UPDATE</code></li>
<li><code>DELETE</code></li>
</ul>
</li>
<li>Tout d‚Äôabord, nous devrons ins&eacute;rer une table &agrave; l'aide de la commande <code>CREATE TABLE table (type de colonne, ...);</code>.</li>
<li>SQL, a &eacute;galement ses propres types de donn&eacute;es pour optimiser la quantit&eacute; d‚Äôespace utilis&eacute; pour le stockage des donn&eacute;es¬†:<ul>
<li><code>BLOB</code>, pour ¬´¬†binary large object¬†¬ª, donn&eacute;es binaires brutes pouvant repr&eacute;senter des fichiers</li>
<li><code>INTEGER</code><ul>
<li><code>smallint</code></li>
<li><code>integer</code></li>
<li><code>bigint</code></li>
</ul>
</li>
<li><code>NUMERIC</code><ul>
<li><code>boolean</code></li>
<li><code>date</code></li>
<li><code>datetime</code></li>
<li><code>numeric(scale,precision)</code>, qui r&eacute;sout l'impr&eacute;cision &agrave; virgule flottante en utilisant autant de bits que n&eacute;cessaire, pour chaque chiffre avant et apr&egrave;s la virgule</li>
<li><code>time</code></li>
<li><code>timestamp</code></li>
</ul>
</li>
<li><code>REAL</code><ul>
<li><code>real</code>, pour les valeurs &agrave; virgule flottante</li>
<li><code>double precision</code>, avec plus de bits</li>
</ul>
</li>
<li><code>TEXT</code><ul>
<li><code>char(n)</code>, pour un nombre exact de caract&egrave;res</li>
<li><code>varchar(n)</code>, pour un nombre variable de caract&egrave;res, jusqu'&agrave; une certaine limite</li>
<li><code>text</code></li>
</ul>
</li>
</ul>
</li>
<li>SQLite est une application de base de donn&eacute;es qui prend en charge SQL, et de nombreuses entreprises proposent des applications serveur qui prennent en charge SQL, notamment Oracle Database, MySQL, PostgreSQL, MariaDB et Microsoft Access.</li>
<li>Apr&egrave;s avoir ins&eacute;r&eacute; des valeurs, nous pouvons &eacute;galement utiliser des fonctions pour effectuer des calculs¬†:<ul>
<li><code>AVG</code></li>
<li><code>COUNT</code></li>
<li><code>DISTINCT</code>, pour obtenir des valeurs distinctes sans doublons</li>
<li><code>MAX</code></li>
<li><code>MIN</code></li>
<li>‚Ä¶</li>
</ul>
</li>
<li>Il existe &eacute;galement d'autres op&eacute;rations que nous pouvons combiner selon les besoins¬†:<ul>
<li><code>WHERE</code>, correspondant &agrave; une condition stricte</li>
<li><code>LIKE</code>, correspondant &agrave; des sous-cha&icirc;nes pour le texte</li>
<li><code>LIMIT</code></li>
<li><code>GROUP BY</code></li>
<li><code>ORDER BY</code></li>
<li><code>JOIN</code>, combinant les donn&eacute;es de plusieurs tables</li>
</ul>
</li>
<li>Nous pouvons mettre &agrave; jour les donn&eacute;es avec <code>UPDATE table SET column=value WHERE condition¬†;</code>, qui peut inclure 0, 1 ou plusieurs lignes selon notre condition. Par exemple, nous pourrions dire <code>UPDATE favorites SET title = "The Office" WHERE title LIKE "%office"</code>, et cela d&eacute;finira toutes les lignes avec le titre contenant ¬´¬†office¬†¬ª comme &eacute;tant ¬´¬†The Office¬†¬ª afin que nous puissions les rendre coh&eacute;rentes.</li>
<li>Et nous pouvons supprimer les lignes correspondantes avec <code>DELETE FROM table WHERE condition¬†;</code>, comme dans <code>DELETE FROM favorites WHERE title = "Friends";</code>.</li>
<li>Nous pouvons m&ecirc;me supprimer compl&egrave;tement une table enti&egrave;re avec une autre commande, <code>DROP</code>.</li>
</ul>
<h2>IMDb</h2>
<ul>
<li>IMDb, ou ¬´¬†Internet Movie Database¬†¬ª, dispose d'ensembles de donn√©es <a href="https://www.imdb.com/interfaces/">disponibles en t√©l√©chargement</a> en tant que fichiers TSV ou valeurs s√©par√©es par des tabulations.</li>
<li>Par exemple, nous pouvons t√©l√©charger <code>title.basics.tsv.gz</code>, qui contiendra des donn√©es de base sur des titres¬†:<ul>
<li><code>tconst</code>, un identifiant unique pour chaque titre, comme <code>tt4786824</code></li>
<li><code>titleType</code>, le type de titre, comme <code>tvSeries</code></li>
<li><code>primaryTitle</code>, le titre principal utilis√©, comme <code>The Crown</code></li>
<li><code>startYear</code>, l'ann√©e de sortie du titre, comme <code>2016</code></li>
<li><code>genres</code>, une liste de genres s√©par√©s par des virgules, comme <code>Drama,History</code></li>
</ul>
</li>
<li>Nous jetons un ≈ìil √† <code>title.basics.tsv</code> apr√®s l'avoir d√©compress√©, et nous voyons que les premi√®res rang√©es sont bien les en-t√™tes que nous attendions et que chaque rang√©e a des valeurs s√©par√©es par des tabulations. Mais le fichier contient plus de 6 millions de rang√©es, donc m√™me la recherche d'une valeur prend un moment.</li>
<li>Nous allons t√©l√©charger le fichier dans notre EDI avec <code>wget</code>, puis <code>gunzip</code> pour le d√©compresser. Mais notre EDI n'a pas assez d'espace, nous allons donc utiliser le terminal de notre Mac √† la place.</li>
<li>
<p>Nous allons √©crire <code>import.py</code> pour lire le fichier¬†:</p>
<pre><code>  import csv

  # Ouvrir le fichier TSV en lecture
  with open("title.basics.tsv", "r") as titres¬†:

      # Le fichier est un fichier TSV, nous pouvons donc utiliser le lecteur CSV et changer le s√©parateur en une tabulation.
      lecteur = csv.DictReader(titres, delimiter="\t")

      # Ouvrir un nouveau fichier CSV en √©criture
      with open("shows0.csv", "w") as spectacles¬†:

          # Cr√©er l'auteur
          auteur = csv.writer(spectacles)

          # √âcrire l'en-t√™te des colonnes que nous voulons
          auteur.writerow(["tconst", "primaryTitle", "startYear", "genres"])

          # It√©rer sur le fichier TSV
          for ligne in lecteur¬†:

              # Si s√©rie t√©l√©vis√©e non-adultes
              if ligne["titleType"] == "tvSeries" and ligne["isAdult"] == "0":

                  # √âcrire la ligne
                  auteur.writerow([ligne["tconst"], ligne["primaryTitle"], ligne["startYear"], ligne["genres"]])
</code></pre>
</li>
<li>
<p>Dor√©navant, nous pouvons ouvrir <code>shows0.csv</code> et voir un ensemble plus r√©duit de donn√©es. Mais il s'av√®re que, pour certaines rang√©es, <code>startYear</code> a une valeur √©gale √† <code>\N</code>, et c'est une valeur sp√©ciale d'IMDb lorsqu'ils veulent repr√©senter des valeurs manquantes. Nous pouvons donc filtrer ces valeurs et convertir l'ann√©e de d√©but en un entier pour filtrer les s√©ries apr√®s 1970¬†:</p>
<pre><code>  ...
  # Si l'ann√©e n'est pas manquante (nous devons √©galement √©chapper la barre oblique inverse)
  if ligne["startYear"] != "\\N":

      # Si depuis 1970
      if int(ligne["startYear"]) &gt;= 1970¬†:

          # √âcrire la ligne
          auteur.writerow([ligne["tconst"], ligne["primaryTitle"], ligne["startYear"], ligne["genres"]])
</code></pre>
</li>
<li>
<p>Nous pouvons √©crire un programme pour rechercher un titre donn√© :</p>
<pre><code>  import csv

  # Inviter l'utilisateur pour le titre
  title = input("Titre : ")

  # Ouvrir le fichier CSV
  with open("shows2.csv", "r") as input:

      # Cr√©er DictReader
      reader = csv.DictReader(input)

      # It√©rer sur le fichier CSV
      for row in reader:

          # Rechercher le titre
          if title.lower() == row["primaryTitle"].lower():
              print(row["primaryTitle"], row["startYear"], row["genres"], sep=" | ")
</code></pre>
<ul>
<li>Nous pouvons ex√©cuter ce programme et voir nos r√©sultats, mais nous pouvons voir comment SQL peut faire un meilleur travail.</li>
</ul>
</li>
<li>
<p>En Python, nous pouvons nous connecter √† une base de donn√©es SQL et y lire notre fichier une fois, afin de pouvoir effectuer de nombreuses requ√™tes sans √©crire de nouveaux programmes et sans avoir √† lire le fichier entier √† chaque fois.</p>
</li>
<li>
<p>Faisons cela plus facilement avec la biblioth√®que CS50 :</p>
<pre><code>  import cs50
  import csv

  # Cr√©er une base de donn√©es en ouvrant puis fermant d'abord un fichier vide
  open(f"shows3.db", "w").close()
  db = cs50.SQL("sqlite:///shows3.db")

  # Cr√©er une table intitul√©e "shows", et sp√©cifier les colonnes que nous voulons,
  #  qui seront tous du texte √† l'exception de "startYear"
  db.execute("CREATE TABLE shows (tconst TEXT, primaryTitle TEXT, startYear NUMERIC, genres TEXT)")

  # Ouvrir le fichier TSV
  # https://datasets.imdbws.com/title.basics.tsv.gz
  with open("title.basics.tsv", "r") as titles:

      # Cr√©er DictReader
      reader = csv.DictReader(titles, delimiter="\t")

      # It√©rer sur le fichier TSV
      for row in reader:

          # S'il s'agit d'une √©mission de t√©l√©vision non-adultes
          if row["titleType"] == "tvSeries" and row["isAdult"] == "0":

              # Si l'ann√©e n'est pas manquante
              if row["startYear"] != "\\N":

                  # Si depuis 1970
                  startYear = int(row["startYear"])
                  if startYear &gt;= 1970:

                      # Ins√©rer l'√©mission en substituant les valeurs dans chaque espace r√©serv√© ?
                      db.execute("INSERT INTO shows (tconst, primaryTitle, startYear, genres) VALUES(?, ?, ?, ?)",
                                 row["tconst"], row["primaryTitle"], startYear, genres)
</code></pre>
</li>
<li>
<p>Maintenant, nous pouvons ex√©cuter <code>sqlite3 shows3.db</code> et ex√©cuter des commandes comme avant, comme <code>SELECT * FROM shows LIMIT 10 ;</code>.</p>
</li>
<li>Avec <code>SELECT COUNT(*) FROM shows ;</code> nous pouvons voir qu'il y a plus de 150 000 √©missions dans notre table, et avec <code>SELECT COUNT(*) FROM shows WHERE startYear = 2019 ;</code>, nous voyons qu'il y en avait plus de 6 000 cette ann√©e.</li>
</ul>
<h2>Tableaux multiples</h2>
<ul>
<li>
<p>Mais chacune des lignes n'aura qu'une colonne pour les genres et les valeurs sont plusieurs genres rassembl√©s. Nous pouvons donc revenir √† notre programme d'importation et ajouter une autre table :</p>
<pre><code>  import cs50
  import csv

  # Cr√©er une base de donn√©es
  open(f"shows4.db", "w").close()
  db = cs50.SQL("sqlite:///shows4.db")

  # Cr√©er des tableaux
  db.execute("CREATE TABLE shows (id INT, title TEXT, year NUMERIC, PRIMARY KEY(id))")

  # La table `genres` aura une colonne appel√©e `show_id` qui fait r√©f√©rence √† la table `shows` ci-dessus
  db.execute("CREATE TABLE genres (show_id INT, genre TEXT, FOREIGN KEY(show_id) REFERENCES shows(id))")

  # Ouvrir un fichier TSV
  # https://datasets.imdbws.com/title.basics.tsv.gz
  with open("title.basics.tsv", "r") as titles:

      # Cr√©er un DictReader
      reader = csv.DictReader(titles, delimiter="\t")

      # Parcourir le fichier TSV
      for row in reader:

          # S'il s'agit d'une √©mission de t√©l√©vision non destin√©e aux adultes
          if row["titleType"] == "tvSeries" and row["isAdult"] == "0":

              # Si l'ann√©e n'est pas manquante
              if row["startYear"] != "\\N":

                  # Si depuis 1970
                  startYear = int(row["startYear"])
                  if startYear &gt;= 1970:

                      # Supprimer le pr√©fixe de tconst
                      id = int(row["tconst"][2:])

                      # Ins√©rer l'√©mission
                      db.execute("INSERT INTO shows (id, title, year) VALUES(?, ?, ?)", id, row["primaryTitle"], startYear)

                      # Ins√©rer les genres
                      if row["genres"] != "\\N":
                          for genre in row["genres"].split(","):
                              db.execute("INSERT INTO genres (show_id, genre) VALUES(?, ?)", id, genre)
</code></pre>
<ul>
<li>Ainsi, notre table <code>shows</code> n'a plus de colonne <code>genres</code>, mais nous avons maintenant une table <code>genres</code> avec chaque ligne repr√©sentant une √©mission et un genre associ√©. D√©sormais, une √©mission particuli√®re peut avoir plusieurs genres que nous pouvons rechercher, et nous pouvons obtenir d'autres donn√©es sur l'√©mission √† partir de la table <code>shows</code> gr√¢ce √† son ID.</li>
</ul>
</li>
<li>
<p>En fait, nous pouvons combiner les deux tables avec <code>SELECT * FROM shows WHERE id IN (SELECT show_id FROM genres WHERE genre = "Comedy") AND year = 2019;</code>. Nous filtrons notre table <code>shows</code> par ID lorsque l'ID dans la table <code>genres</code> a une valeur de ‚ÄúComedy‚Äù pour la colonne <code>genre</code> et une valeur de 2019 pour la colonne <code>year</code>.</p>
</li>
<li>Nos tables ressemblent √† ceci :
  <img alt="tableau intitul√© ¬´¬†shows¬†¬ª avec les entr√©es ID, titre et ann√©e et tableau intitul√© ¬´¬†genres¬†¬ª avec show_id et genre et fl√®che allant de show_id vers ID" src="https://cs50.harvard.edu/x/2020/notes/7/shows_table_genres_table.png" /><ul>
<li>√âtant donn√© que l'ID dans la table <code>genre</code> provient de la table <code>shows</code>, nous l'appelons <code>show_id</code>. Et la fl√®che indique qu'un m√™me ID d'√©mission peut avoir de nombreuses lignes correspondantes dans la table <code>genres</code>.</li>
</ul>
</li>
<li>Nous voyons que certains jeux de donn√©es d'IMDb, comme <code>title.principals.tsv</code>, ne comportent que des ID pour certaines colonnes que nous devrons rechercher dans d'autres tables.</li>
<li>En lisant les descriptions de chaque table, nous pouvons voir que toutes les donn√©es peuvent √™tre utilis√©es pour cr√©er ces tables¬†:
  <img alt="tableau intitul√© ¬´¬†people, shows, genres, ratings, stars, writers¬†¬ª avec des fl√®ches indiquant les ID entre les tables" src="https://cs50.harvard.edu/x/2020/notes/7/imdb_tables.png" /><ul>
<li>Notez que, par exemple, le nom d'une personne peut √©galement √™tre copi√© dans les tables <code>stars</code> ou <code>writers</code>, mais seul le <code>person_id</code> est utilis√© pour cr√©er un lien vers les donn√©es de la table <code>people</code>. De cette fa√ßon, nous n'avons besoin de mettre √† jour le nom qu'√† un seul endroit si nous devons effectuer une modification.</li>
</ul>
</li>
<li>Nous allons ouvrir une base de donn√©es, <code>shows.db</code>, avec ces tables pour voir d'autres exemples.</li>
<li>Nous allons t√©l√©charger un programme appel√© <a href="https://sqlitebrowser.org/dl/">DB Browser for SQLite</a>, qui disposera d'une interface utilisateur graphique pour parcourir nos tables et nos donn√©es. Nous pouvons √©galement utiliser l'onglet ‚ÄúExecute SQL‚Äù pour ex√©cuter directement du SQL dans le programme.</li>
<li>Nous pouvons ex√©cuter <code>SELECT * FROM shows JOIN genres ON show.id = genres.show_id;</code> pour joindre deux tables en faisant correspondre les ID dans les colonnes que nous sp√©cifions. Nous obtiendrons alors une table plus large, avec des colonnes de chacune de ces deux tables.</li>
<li>Nous pouvons prendre l'ID d'une personne et la retrouver dans les √©missions avec <code>SELECT * FROM stars WHERE person_id = 1122;</code>, mais nous pouvons faire une requ√™te dans notre requ√™te avec <code>SELECT show_id FROM stars WHERE person_id = (SELECT id FROM people WHERE name = "Ellen DeGeneres");</code>.</li>
<li>Cela nous renvoie le <code>show_id</code>, donc pour obtenir les donn√©es de l'√©mission, nous pouvons ex√©cuter : <code>SELECT * FROM shows WHERE id IN (...);</code> avec <code>...</code> √©tant la requ√™te ci-dessus.</li>
<li>
<p>Nous pouvons obtenir les m√™mes r√©sultats avec¬†:</p>
<pre><code>  SELECT title FROM
  people JOIN stars ON people.id = stars.person_id JOIN
  shows ON stars.show_id = shows.id
  WHERE name = "Ellen DeGeneres"
</code></pre>
<ul>
<li>Nous joignons la table <code>people</code> avec la table <code>stars</code>, puis avec la table <code>shows</code> en sp√©cifiant les colonnes qui doivent correspondre entre les tables, puis en s√©lectionnant uniquement le <code>titre</code> avec un filtre sur le nom.</li>
<li>Mais maintenant, nous pouvons √©galement s√©lectionner d'autres champs dans nos tables combin√©es.</li>
</ul>
</li>
<li>
<p>Il s'av√®re que nous pouvons sp√©cifier que des colonnes de nos tables soient des types sp√©ciaux, tels que¬†:</p>
<ul>
<li><code>PRIMARY KEY</code>, utilis√© comme identifiant principal pour une ligne</li>
<li><code>FOREIGN KEY</code>, qui pointe vers une ligne d'une autre table</li>
<li><code>UNIQUE</code>, ce qui signifie qu'il doit √™tre unique dans cette table</li>
<li><code>INDEX</code>, qui demande √† notre base de donn√©es de cr√©er un index pour interroger plus rapidement en fonction de cette colonne. Un index est une structure de donn√©es telle qu'un arbre qui nous aide √† rechercher des valeurs.</li>
</ul>
</li>
<li>Nous pouvons cr√©er un index avec <code>CREATE INDEX person_index ON stars (person_id);</code>. Ensuite, la colonne <code>person_id</code> aura un index appel√© <code>person_index</code>. Avec les bons index, notre requ√™te de jonction est plusieurs centaines de fois plus rapide.</li>
</ul>
<h2>Probl√®mes</h2>
<ul>
<li>Un probl√®me avec les bases de donn√©es est la <strong>condition de course</strong>, dans laquelle le moment de deux actions ou √©v√®nements provoque un comportement inattendu.</li>
<li>Par exemple, prenons deux colocataires et un frigo partag√© dans leur dortoir. Le premier colocataire rentre chez lui et voit qu'il n'y a plus de lait dans le frigo. Il part donc au magasin pour acheter du lait et, alors qu'il est au magasin, le deuxi√®me colocataire rentre chez lui, voit qu'il n'y a plus de lait et part dans un autre magasin pour en acheter. Plus tard, il y aura deux briques de lait dans le frigo. En laissant un mot, on peut r√©soudre ce probl√®me. On peut m√™me verrouiller le frigo pour que notre colocataire ne puisse pas v√©rifier s'il y a du lait jusqu'√† notre retour.</li>
<li>
<p>Cela peut se produire dans notre base de donn√©es si nous avons quelque chose comme ceci¬†:</p>
<pre><code>  rows = db.execute("SELECT likes FROM posts WHERE id=?", id);
  likes = rows[0]["likes"]
  db.execute("UPDATE posts SET likes = ?", likes + 1);
</code></pre>
<ul>
<li>Premi√®rement, nous obtenons le nombre de likes sur un post avec un ID donn√©. Ensuite, nous d√©finissons le nombre de likes comme √©tant ce nombre plus un.</li>
<li>Mais maintenant, si nous avons deux serveurs web diff√©rents essayant tous les deux d'ajouter un like, ils pourraient tous les deux le d√©finir comme √©tant la m√™me valeur au lieu d'en ajouter r√©ellement un √† chaque fois. Par exemple, s'il y a 2 likes, les deux serveurs v√©rifieront le nombre de likes, verront qu'il y en a 2 et d√©finira la valeur √† 3. L'un des likes sera alors perdu.</li>
</ul>
</li>
<li>
<p>Pour r√©soudre ce probl√®me, nous pouvons utiliser des transactions, dans lesquelles un ensemble d'actions est garanti de se produire ensemble.</p>
</li>
<li>Un autre probl√®me en SQL est appel√© <strong>attaque par injection SQL</strong>, dans laquelle un adversaire peut ex√©cuter ses propres commandes sur notre base de donn√©es.</li>
<li>Par exemple, quelqu'un pourrait essayer de saisir <code>malan@harvard.edu'--</code> comme adresse e-mail. Si nous avons une requ√™te SQL qui est une cha√Æne format√©e (sans √©chappement ou substitution de caract√®res dangereux √† partir de l'entr√©e), comme <code>f"SELECT * FROM users WHERE username = '{username}' AND password = '{password}'"</code>, alors la requ√™te finira par √™tre <code>f"SELECT * FROM users WHERE username = 'malan@harvard.edu'--' AND password = '{password}'"</code>, ce qui s√©lectionnera en fait la ligne o√π <code>username = 'malan@harvard.edu'</code> et transformera le reste de la ligne¬†en commentaire. Pour √©viter cela, nous devrions utiliser des espaces r√©serv√©s <code>?</code> pour que notre biblioth√®que SQL √©chappe automatiquement les entr√©es de l'utilisateur.</li>
</ul>


        </main>
      </div>
    </div>
  </body>

</html>